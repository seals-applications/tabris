# 営業支援ツール - Supabaseセットアップ手順

## 概要
このアプリは営業マンがお客様のスマートフォン料金診断を管理する営業支援ツールです。
GitHub Pagesでホストされ、Supabaseを使用して診断履歴の保存と営業管理機能を提供します。

## 1. Supabaseプロジェクトの作成

### 1.1 Supabaseアカウント作成
1. [supabase.com](https://supabase.com)にアクセス
2. GitHubアカウントでサインアップ
3. 新しいプロジェクトを作成

### 1.2 プロジェクト設定
- **プロジェクト名**: `sales-support-tool`（任意）
- **データベースパスワード**: 安全なパスワードを設定
- **リージョン**: 日本（Tokyo）を選択

## 2. データベーススキーマの作成

### 2.1 SQLエディタでスキーマを実行
1. Supabaseダッシュボードで「SQL Editor」を開く
2. `sales-schema.sql`の内容をコピー＆ペースト
3. 「Run」ボタンをクリックして実行

### 2.2 テーブルの確認
以下のテーブルが作成されていることを確認：
- `sales_users` - 営業マン情報
- `diagnosis_history` - 診断履歴（営業マンとお客様情報を含む）
- `family_members` - 家族情報（詳細診断用）

### 2.3 データベース関数の確認
`create_sales_user_if_not_exists`関数が作成されていることを確認

## 3. API設定の取得

### 3.1 プロジェクト設定から認証情報を取得
1. ダッシュボードで「Settings」→「API」を開く
2. 以下の情報をコピー：
   - **Project URL**: `https://your-project.supabase.co`
   - **anon public key**: `your-anon-key`

### 3.2 設定ファイルの更新
`js/supabase-config.js`を開き、以下の値を実際の値に置き換え：

```javascript
const supabaseUrl = 'https://your-project.supabase.co'; // 実際のProject URL
const supabaseAnonKey = 'your-anon-key'; // 実際のanon public key
```

## 4. セキュリティ設定

### 4.1 RLS（Row Level Security）の確認
- データベースでRLSが有効になっていることを確認
- 匿名ユーザーでも読み書き可能なポリシーが設定されていることを確認

### 4.2 CORS設定（必要に応じて）
1. ダッシュボードで「Settings」→「API」を開く
2. 「CORS」セクションで以下を追加：
   - `https://your-username.github.io`
   - `http://localhost:3000`（開発用）

## 5. 機能の説明

### 5.1 営業マン管理機能
- **営業マンログイン**: 営業マン名を入力するだけでログイン
- **表示名**: 診断結果に表示される営業マン名（任意）
- **自動営業マン作成**: 初回ログイン時に自動で営業マンを作成
- **ログアウト機能**: ローカルストレージから営業マン情報を削除

### 5.2 お客様情報管理
- **お客様情報入力**: 診断前に任意でお客様の名前、電話番号、メールアドレスを入力
- **お客様情報保存**: 診断結果と一緒にお客様情報を保存
- **お客様情報表示**: 履歴でお客様情報を確認可能

### 5.3 診断履歴管理
- **個人履歴**: 自分の診断履歴のみ表示
- **営業ステータス**: 新規、連絡済み、提案中、成約、失注のステータス管理
- **共有機能**: 共有コードで他の営業マンと結果を共有
- **全営業マン閲覧**: 他の営業マンの診断結果を閲覧・管理

### 5.4 データベース構造
- **sales_users**: 営業マン基本情報（将来的な認証システム対応）
- **diagnosis_history**: 診断履歴（営業マンID、お客様情報、営業ステータスを含む）
- **family_members**: 家族情報（詳細診断用）

## 6. テスト

### 6.1 基本的な動作確認
1. アプリを開く
2. 営業マンログイン画面が表示されることを確認
3. 営業マン名を入力してログイン
4. お客様情報を入力（任意）
5. 診断を実行
6. 結果が保存されることを確認
7. 履歴が表示されることを確認

### 6.2 営業管理機能のテスト
1. 診断結果の営業ステータスを確認
2. 他の営業マンの診断結果を閲覧
3. 営業ステータスを編集
4. 共有機能をテスト

### 6.3 共有機能のテスト
1. 診断結果の共有コードをコピー
2. 新しいタブで共有URLにアクセス
3. 共有された結果が表示されることを確認

## 7. 営業ワークフロー

### 7.1 基本的な営業フロー
1. **営業マンログイン**: 営業マンが自分の名前でログイン
2. **お客様情報入力**: お客様の基本情報を入力（任意）
3. **診断実行**: お客様と一緒に診断を実行
4. **結果保存**: 診断結果とお客様情報を保存
5. **営業ステータス管理**: 営業の進捗に応じてステータスを更新
6. **フォローアップ**: 必要に応じてフォローアップ予定日を設定

### 7.2 営業ステータスの意味
- **新規**: 診断完了、まだ営業活動未実施
- **連絡済み**: お客様に連絡済み
- **提案中**: 具体的な提案を実施中
- **成約**: 契約成立
- **失注**: 契約不成立

## 8. トラブルシューティング

### 8.1 よくある問題

#### 営業マンログインできない
- Supabaseの設定が正しいか確認
- ブラウザのコンソールでエラーメッセージを確認
- データベース関数が正しく作成されているか確認

#### データが保存されない
- 営業マンが正しくログインしているか確認
- RLSポリシーが正しく設定されているか確認

#### 共有機能が動作しない
- 共有コードが正しく生成されているか確認
- URLパラメータが正しく処理されているか確認

#### CORSエラーが発生する
- SupabaseのCORS設定を確認
- 正しいドメインが設定されているか確認

### 8.2 ログの確認
- ブラウザの開発者ツールでコンソールログを確認
- Supabaseダッシュボードで「Logs」を確認

## 9. 将来的な拡張

### 9.1 認証システムの導入
現在の営業マン名ベースシステムから、以下の認証システムへの移行が可能：
- **Supabase Auth**: メール/パスワード認証
- **ソーシャルログイン**: Google、GitHub、Facebook等
- **二要素認証**: SMS、メール、認証アプリ

### 9.2 営業管理機能の拡張
- **営業活動記録**: 営業活動の詳細記録
- **フォローアップ管理**: 自動フォローアップリマインダー
- **営業レポート**: 営業マン別の営業実績レポート
- **顧客管理**: 顧客情報の詳細管理

### 9.3 分析機能
- **営業実績分析**: 営業マン別の成約率分析
- **診断結果分析**: 診断結果と成約率の相関分析
- **顧客分析**: 顧客属性と診断結果の分析

## 10. 本番環境での注意点

### 10.1 セキュリティ
- 本番環境では適切な認証を検討
- 顧客情報の暗号化を検討
- 定期的なバックアップを設定

### 10.2 パフォーマンス
- データベースのインデックスを最適化
- 不要なデータの定期的な削除を検討

### 10.3 監視
- Supabaseの使用量を監視
- エラーログを定期的に確認

## 11. サポート

問題が発生した場合は以下を確認：
1. [Supabase公式ドキュメント](https://supabase.com/docs)
2. [GitHub Issues](https://github.com/your-repo/issues)
3. [Supabase Discord](https://discord.supabase.com)

## 12. ライセンス

このプロジェクトはMITライセンスの下で公開されています。 